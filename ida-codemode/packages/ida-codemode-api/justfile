set shell := ["bash", "-eu", "-o", "pipefail", "-c"]

all: docs lint tests

rebuild-api-reference:
    PYTHONPATH=. python -c 'from pathlib import Path; from ida_codemode_api.api import api_reference; text = api_reference() + "\n"; Path("ida_codemode_api/prompts/api_reference.md").write_text(text + "\n<!--- (autogenerated file: do not edit) -->\n", encoding="utf-8");'

docs: rebuild-api-reference

ruff:
    uvx ruff check .

ty:
    uvx ty check ida_codemode_api tests

lint: ruff ty

tests:
    PYTHONPATH=. python -m pytest tests -v

test: tests
